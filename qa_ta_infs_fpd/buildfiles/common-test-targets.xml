<project name="common-jar-targets"
         default=""
         xmlns:ivy="antlib:org.apache.ivy.ant"
>

	<import file="./common-test.xml" />
	<!-- ================================= 
          target: resolve              
         ================================= -->
	<target name="resolve"
	        description="--> resolve and retrieve dependencies with ivy"
	>
		<ivy:retrieve />
		<mkdir dir="${lib.dir}" />		
	</target>

	<!-- ================================= 
          target: report              
         ================================= -->
	<target name="report"
	        depends="resolve"
	        description="--> report the dependencies this project use"
	>
		<ivy:report />
	</target>
		
	<!-- ================================= 
          target: compile              
         ================================= -->
	<target name="compile" depends="clean,createdir,resolve" description="--> description">
		<mkdir dir="${classes.dir}" />
		<mkdir dir="${release.classes.dir}" />
		<javac encoding="${compile.encoding}"
		       destdir="${classes.dir}"
		       classpathref="lib.path.id"
		       debug="${build.debug}"
		       fork="true" 
		       memoryinitialsize="128m"
               memorymaximumsize="256m"
			  includeantruntime="on" 
		>
			<src path="${source.dir}"  />
		</javac>

		<copy todir="${release.classes.dir}">
			<fileset dir="${classes.dir}" />
			<fileset dir="${resources.dir}" excludes="**/*.java" />
			<fileset dir="${source.dir}" excludes="**/*.java"/>
		</copy>
	</target>
	
	<!-- ================================= 
          target: clean              
         ================================= -->
	<target name="clean" description="--> clean the project">	
		<delete dir="${build.dir}" />
		<delete dir="${lib.dir}" />
		<delete dir="${release.dir}" />
	</target>
	<target name="createdir" unless="resources.is.existent" description="--> mkdir">
		<mkdir dir="${resources.dir}"  />	
	</target>
	<target name="jar"
		        depends="compile"
		        description="--> make a jar file for this project"
		>
			<jar destfile="${lib.dir}/${ant.project.name}.jar">
				<fileset dir="${release.classes.dir}">
					<exclude name="**/log4j.*" />
				</fileset>
			</jar>
		</target>
	
	
	
	<taskdef resource="testngtasks" classpath="${lib.local.dir}/bill99qa/testng-6.8-nobsh-noguice.jar" />
	<target name="runtest" depends="jar">
		<testng outputDir="${testng.report.dir}" haltOnfailure="false" classpathref="lib.path.id"  listeners="com.bill99.testmp.ta.listener.SuiteListener,com.bill99.testmp.ta.listener.InvokedMethodListener">
			<sysproperty key="JOB_NAME" value="${env.JOB_NAME}" />
			<sysproperty key="BUILD_NUMBER" value="${env.BUILD_NUMBER}" />
			<sysproperty key="BUILD_ID" value="${env.BUILD_ID}" />
			<sysproperty key="ID_TA_TASK" value="${env.ID_TA_TASK}" />
			<sysproperty key="user.dir" value="${basedir}" />
			<xmlfileset dir="${basedir}" includes="jenkins_job.xml" />
		</testng>
	</target>
</project>